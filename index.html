<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart QR Generator (ASCII & SVG)</title>
    <style>
        :root { --primary: #007bff; --bg: #f8f9fa; --text: #333; }
        body { font-family: system-ui, -apple-system, sans-serif; padding: 20px; background: var(--bg); color: var(--text); text-align: center; }
        
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: monospace; box-sizing: border-box; resize: vertical; margin-bottom: 15px; }

        /* Mode Switcher */
        .mode-switch { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .mode-label { cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: 500; }
        input[type="radio"] { accent-color: var(--primary); transform: scale(1.2); }

        /* Output Area */
        .output-wrapper {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            margin: 20px 0;
            padding: 10px;
            overflow: hidden;
        }

        /* ASCII Style */
        pre#qr-ascii {
            background:white;
            color:black;
            /* font-family: 'Roboto Mono', 'Droid Sans Mono', SFMono-Regular, Consolas, monospace; */
            /* font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; */
            font-family: 'Roboto Mono', 'Droid Sans Mono', 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            line-height: 1.1;
            font-size: clamp(8px, 2vw, 14px); 
            overflow-x: auto;        
            max-width: 100%;
            white-space: pre;
            display: none; /* Hidden by default */
        }

        pre#qr-ascii span {
            display: inline-block;
            width: 1ch;
            text-align: center;
        }

        /* SVG Style */
        #qr-svg {
            width: 100%;
            max-width: 250px;
            height: auto;
            display: none; /* Hidden by default */
        }
        
        /* Show active element based on class */
        .active-view { display: block !important; }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        button { padding: 10px 20px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        button.outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        button.outline:hover { background: var(--primary); color: white; }

    </style>
</head>
<body>

    <div class="container">
        <h2>QR Code Generator</h2>
        <p style="color:#666; font-size: 0.9em;">Supports WhatsApp Format (ASCII) & Vector (SVG)</p>

        <textarea id="text-input" rows="2" placeholder="Type URL here...">https://github.com/AhmedE404/Ascii-QR-Generator</textarea>

        <div class="mode-switch">
            <label class="mode-label">
                <input type="radio" name="mode" value="ascii" checked onchange="renderQR()"> 
                ASCII Text (WhatsApp/Terminal)
            </label>
            <label class="mode-label">
                <input type="radio" name="mode" value="svg" onchange="renderQR()"> 
                SVG Image (Web/Design)
            </label>
        </div>

        <div class="output-wrapper">
            <pre id="qr-ascii"></pre>
            <div id="qr-svg"></div>
        </div>

        <div class="btn-group">
            <button onclick="handleCopy()">Copy to Clipboard</button>
            <button class="outline" onclick="handleDownload()">Download File</button>
        </div>
    </div>

    <script src="qrcode.min.js" onerror="this.onerror=null; this.src='https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js'"></script>

    <script>
        let currentQR = null; // To store the matrix

        // --- Core Logic ---
        function ensureLib(callback) {
            if (typeof qrcode === 'function') callback();
            else setTimeout(() => ensureLib(callback), 100);
        }

        function renderQR() {
            ensureLib(() => {
                const text = document.getElementById('text-input').value || " ";
                const mode = document.querySelector('input[name="mode"]:checked').value;
                
                // 1. Generate Matrix
                const qr = qrcode(0, 'M');
                qr.addData(unescape(encodeURIComponent(text)));
                qr.make();
                currentQR = qr; // Store for later use

                // 2. Render based on Mode
                if (mode === 'ascii') {
                    renderASCII(qr);
                } else {
                    renderSVG(qr);
                }
            });
        }

        function renderASCII(qr) {
            document.getElementById('qr-svg').classList.remove('active-view');
            document.getElementById('qr-ascii').classList.add('active-view');

            const count = qr.getModuleCount();
            let asciiDisplay = "";

            for (let y = 0; y < count; y += 2) {
                let line = "";
                for (let x = 0; x < count; x++) {
                    const top = qr.isDark(y, x);
                    const bottom = (y + 1 < count) ? qr.isDark(y + 1, x) : false;
                    if (top && bottom) line += "<span>█</span>";
                    else if (top) line += "<span>▀</span>";
                    else if (bottom) line += "<span>▄</span>";
                    // else line += "<span>\u00A0</span>";
                    // else line += "<span>&nbsp;</span>";
                    // else line += "<span>&#32;</span>";
                    else line += "<span> </span>";
                }
                asciiDisplay += line + "\n";
            }
            document.getElementById('qr-ascii').innerHTML = asciiDisplay;
        }

        function renderSVG(qr) {
            document.getElementById('qr-ascii').classList.remove('active-view');
            document.getElementById('qr-svg').classList.add('active-view');

            const count = qr.getModuleCount();
            // Create SVG String
            let svgHtml = `<svg viewBox="0 0 ${count} ${count}" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges">`;
            svgHtml += `<rect width="100%" height="100%" fill="white"/>`; // White Background
            
            for (let y = 0; y < count; y++) {
                for (let x = 0; x < count; x++) {
                    if (qr.isDark(y, x)) {
                        svgHtml += `<rect x="${x}" y="${y}" width="1" height="1" fill="black"/>`;
                    }
                }
            }
            svgHtml += `</svg>`;
            document.getElementById('qr-svg').innerHTML = svgHtml;
        }

        // --- Action Handlers ---

        function handleCopy() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            let content = "";

            if (mode === 'ascii') {
                const rawAscii = document.getElementById('qr-ascii').textContent;
                // Add Markdown Backticks for WhatsApp/Discord
                content = "```\n" + rawAscii + "```";
            } else {
                // Copy SVG Source Code
                content = document.getElementById('qr-svg').innerHTML;
            }

            navigator.clipboard.writeText(content).then(() => {
                alert(mode.toUpperCase() + " Copied! " + (mode === 'ascii' ? "(Formatted for WhatsApp)" : ""));
            });
        }

        function handleDownload() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            if (mode === 'ascii') {
                // Download as HTML with <pre>
                const rawAscii = document.getElementById('qr-ascii').textContent;
                const htmlContent = `
<!DOCTYPE html>
<html>
<body style="background:#f4f4f4; display:flex; justify-content:center; align-items:center; height:100vh;">
    <pre style="background:white; color:black; font-family:monospace; line-height:1; padding:20px; border:5px solid white;">
${rawAscii}
    </pre>
</body>
</html>`;
                downloadFile("qrcode_ascii.html", htmlContent, "text/html");
            } else {
                // Download as .svg file
                const svgContent = document.getElementById('qr-svg').innerHTML;
                downloadFile("qrcode.svg", svgContent, "image/svg+xml");
            }
        }

        // Helper for downloading
        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Events ---
        document.getElementById('text-input').addEventListener('input', renderQR);
        window.addEventListener('load', renderQR);

    </script>
</body>
</html>